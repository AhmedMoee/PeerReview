{% extends "base.html" %}
{% load widget_tweaks %}
{% block content %}
{% load static %}

<!-- project_view -> project_uploads -->

<!-- new uploads file page -->

<div class="container mt-5">
    <h1 class="mb-4"> Upload Files for: {{ project.name }}</h1>

    {% if user.is_authenticated %}
        {% if user in project.members.all %}
            <!-- File Upload Section -->
            <div class="card mb-4">
                <div class="card-header bg-primary text-white">
                    <h2 class="h4 mb-0">Upload File</h2>
                </div>
                <div class="card-body">
                    <form method="post" enctype="multipart/form-data" class="mb-3">
                        {% csrf_token %}
                        <!-- Display Non-field Errors -->
                        {% if form.non_field_errors %}
                            <div class="alert alert-danger">
                                {{ form.non_field_errors }}
                            </div>
                        {% endif %}

                        <!-- Display Name Field with Error Handling -->
                        <div class="form-group mb-3">
                            {{ form.name.label_tag }}
                            {{ form.name|add_class:"form-control" }}
                            {% if form.name.errors %}
                                <div class="text-danger">
                                    {{ form.name.errors|join:", " }}
                                </div>
                            {% endif %}
                        </div>
                        <div class="form-group mb-3">
                            {{ form.description.label_tag }}
                            {{ form.description|add_class:"form-control" }}
                        </div>
                        <div class="form-group mb-3">
                            {{ form.keywords.label_tag }}
                            {{ form.keywords|add_class:"form-control" }}
                        </div>

                        <!-- Drag-and-Drop File Upload Section -->
                        <div id="drag-and-drop-area" class="mb-3" style="width: 100%; height: 200px; border-radius: 20px; border: 2px dashed #cecdd1; background: #ffffff; display: flex; flex-direction: column; justify-content: center; align-items: center; cursor: pointer;">
                            <input type="file" id="file-input" name="file" class="d-none" />
                            <div>
                                <img src="{% static 'images/upload-icon.png' %}" alt="Upload" style="max-width: 75px; height: auto;">
                            </div>
                            <p>Drag and drop or click here to upload a file</p>
                            <!-- Display selected file name here -->
                            <div id="file-name" class="text-center text-muted">No file selected</div>
                        </div>       

                        <button type="submit" class="btn btn-primary me-2">Upload</button>
                    </form>
                </div>
            </div>
        {% endif %}
    {% else %}
        <p>You are not a member of this project. Please request to join.</p>
        <form action="{% url 'request_to_join' project.id %}" method="post">
            {% csrf_token %}
            <button type="submit" class="btn btn-primary">Request to Join</button>
        </form>
    {% endif %}

    <!-- Back to Project Button -->
    <a href="{% url 'project_main_view' project.name project.id %}" class="btn btn-secondary mt-4">Back to Project</a>
</div> <!-- End of Container -->

<script>
    const dropArea = document.getElementById('drag-and-drop-area');
    const fileInput = document.getElementById('file-input');
    const fileNameDisplay = document.getElementById('file-name');

    dropArea.addEventListener('click', function() {
        fileInput.click();
    });

    fileInput.addEventListener('change', function(event) {
        const files = event.target.files;
        if (files.length > 0) {
            fileNameDisplay.textContent = files[0].name;
        }
    });

    dropArea.addEventListener('dragover', function(event) {
        event.preventDefault(); // stops from opening the file in a new tab
        dropArea.style.backgroundColor = '#f0f0f0';
    });

    dropArea.addEventListener('drop', function(event) {
        event.preventDefault();
        dropArea.style.backgroundColor = '#ffffff';

        const files = event.dataTransfer.files;
        if (files.length > 0) {
            fileNameDisplay.textContent = files[0].name;
            fileInput.files = files;
        }
    });
</script>

{% endblock %}